---
identifier: "GMS-2023-353"
identifiers:
- "GHSA-74m5-2c7w-9w3x"
- "GMS-2023-353"
package_slug: "pypi/starlette"
title: "MultipartParser denial of service with too many fields or files"
description: "### Impact\n\nThe `MultipartParser` using the package `python-multipart`
  accepts an unlimited number of multipart parts (form fields or files).\n\nProcessing
  too many parts results in high CPU usage and high memory usage, eventually leading
  to an <abbr title=\"out of memory\">OOM</abbr> process kill.\n\nThis can be triggered
  by sending too many small form fields with no content, or too many empty files.\n\nFor
  this to take effect application code has to:\n\n* Have `python-multipart` installed
  and\n* call `request.form()`\n * or via another framework like FastAPI, using form
  field parameters or `UploadFile` parameters, which in turn calls `request.form()`.\n\n###
  Patches\n\nThe vulnerability is solved in Starlette 0.25.0 by making the maximum
  fields and files customizable and with a sensible default (1000). \n\nApplications
  will be secure by just upgrading their Starlette version to 0.25.0 (or FastAPI to
  0.92.0).\n\nIf application code needs to customize the new max field and file number,
  there are new `request.form()` parameters (with the default values):\n\n* `max_files=1000`\n*
  `max_fields=1000`\n\n### Workarounds\n\nApplications that don't install `python-multipart`
  or that don't use form fields are safe.\n\nIn older versions, it's also possible
  to instead of calling `request.form()` call `request.stream()` and parse the form
  data in internal code.\n\nIn most cases, the best solution is to upgrade the Starlette
  version.\n\n### References\n\nThis was reported in private by @das7pad via internal
  email. He also coordinated the fix across multiple frameworks and parsers.\n\nThe
  details about how `multipart/form-data` is structured and parsed are in the [RFC
  7578](https://www.rfc-editor.org/rfc/rfc7578).\n"
date: "2023-02-14"
pubdate: "2023-02-14"
affected_range: "<0.25.0"
fixed_versions:
- "0.25.0"
affected_versions: "All versions before 0.25.0"
not_impacted: "All versions starting from 0.25.0"
solution: "Upgrade to version 0.25.0 or above."
urls:
- "https://github.com/encode/starlette/security/advisories/GHSA-74m5-2c7w-9w3x"
- "https://github.com/advisories/GHSA-74m5-2c7w-9w3x"
uuid: "9e9fe64a-df87-41da-9d18-dc0b2d0e16c3"
cwe_ids:
- "CWE-1035"
- "CWE-937"
