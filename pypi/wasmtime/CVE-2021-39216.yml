---
identifier: "CVE-2021-39216"
package_slug: "pypi/wasmtime"
title: "Use After Free"
description: "Wasmtime is an open source runtime for WebAssembly & WASI. In Wasmtime
  from and there was a use-after-free bug when passing `externref`s from the host
  to guest Wasm content. To trigger the bug, you have to explicitly pass multiple
  `externref`s from the host to a Wasm instance at the same time, either by passing
  multiple `externref`s as arguments from host code to a Wasm function, or returning
  multiple `externref`s to Wasm from a multi-value return function defined in the
  host. If you do not have host code that matches one of these shapes, then you are
  not impacted. If Wasmtime's `VMExternRefActivationsTable` became filled to capacity
  after passing the first `externref` in, then passing in the second `externref` could
  trigger a garbage collection. However the first `externref` is not rooted until
  we pass control to Wasm, and therefore could be reclaimed by the collector if nothing
  else was holding a reference to it or otherwise keeping it alive. Then, when control
  was passed to Wasm after the garbage collection, Wasm could use the first `externref`,
  which at this point has already been freed. We have reason to believe that the effective
  impact of this bug is relatively small because usage of `externref` is currently
  quite rare. The bug has been fixed, and users should upgrade to Wasmtime If you
  cannot upgrade Wasmtime yet, you can avoid the bug by disabling reference types
  support in Wasmtime by passing `false` to `wasmtime::Config::wasm_reference_types`."
date: "2021-10-04"
pubdate: "2021-09-17"
affected_range: ">=0.19.0,<0.30.0"
fixed_versions:
- "0.30.0"
affected_versions: "All versions starting from 0.19.0 before 0.30.0"
not_impacted: "All versions before 0.19.0, all versions starting from 0.30.0"
solution: "Upgrade to version 0.30.0 or above."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2021-39216"
cvss_v2: "AV:L/AC:M/Au:N/C:N/I:P/A:P"
cvss_v3: "CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:H/A:H"
uuid: "2e7d5a4d-2504-409e-8abd-83725ee0b17a"
