---
identifier: "CVE-2023-36820"
identifiers:
- "GHSA-qw22-8w9r-864h"
- "CVE-2023-36820"
package_slug: "maven/io.micronaut.security/micronaut-security-oauth2"
title: "io.micronaut.security:micronaut-security-oauth2 has invalid IdTokenClaimsValidator
  logic on aud"
description: "### Summary\n\nIdTokenClaimsValidator skips `aud` claim validation if
  token is issued by same identity issuer/provider.\n\n### Details\n\nSee https://github.com/micronaut-projects/micronaut-security/blob/master/security-oauth2/src/main/java/io/micronaut/security/oauth2/client/IdTokenClaimsValidator.java#L202\n\nThis
  logic violates point 3 of https://openid.net/specs/openid-connect-core-1_0.html#IDTokenValidation.
  \n\nWorkaround exists by setting `micronaut.security.token.jwt.claims-validators.audience`
  with valid values. \n `micronaut.security.token.jwt.claims-validators.openid-idtoken`
  can be kept as default on.\n\n### PoC\n\nShould probably be:\n\n```java\n        return
  issuer.equalsIgnoreCase(iss) &&\n            audiences.contains(clientId) &&\n                validateAzp(claims,
  clientId, audiences);\n```\n\n### Impact\n\nAny OIDC setup using Micronaut where
  multiple OIDC applications exists for the same issuer but token auth are not meant
  to be shared.\n"
date: "2023-10-05"
pubdate: "2023-10-05"
affected_range: "(,3.1),[3.1.0,3.1.2),[3.2.0,3.2.4),[3.3.0,3.3.2),[3.4.0,3.4.3),[3.5.0,3.5.3),[3.6.0,3.6.6),[3.7.0,3.7.4),[3.8.0,3.8.4),[3.9.0,3.9.6),[3.10.0,3.10.2),[3.11.0,3.11.1)"
fixed_versions:
- "3.10.2"
- "3.11.1"
- "3.8.4"
- "3.9.6"
- "3.4.3"
- "3.5.3"
- "3.6.6"
- "3.7.4"
- "3.1.2"
- "3.2.4"
- "3.3.2"
affected_versions: "All versions before 3.1, all versions starting from 3.1.0 before
  3.1.2, all versions starting from 3.2.0 before 3.2.4, all versions starting from
  3.3.0 before 3.3.2, all versions starting from 3.4.0 before 3.4.3, all versions
  starting from 3.5.0 before 3.5.3, all versions starting from 3.6.0 before 3.6.6,
  all versions starting from 3.7.0 before 3.7.4, all versions starting from 3.8.0
  before 3.8.4, all versions starting from 3.9.0 before 3.9.6, all versions starting
  from 3.10.0 before 3.10.2, all versions starting from 3.11.0 before 3.11.1"
not_impacted: "All versions starting from 3.1.0 before 3.1.0, all versions starting
  from 3.1.2 before 3.2.0, all versions starting from 3.2.4 before 3.3.0, all versions
  starting from 3.3.2 before 3.4.0, all versions starting from 3.4.3 before 3.5.0,
  all versions starting from 3.5.3 before 3.6.0, all versions starting from 3.6.6
  before 3.7.0, all versions starting from 3.7.4 before 3.8.0, all versions starting
  from 3.8.4 before 3.9.0, all versions starting from 3.9.6 before 3.10.0, all versions
  starting from 3.10.2 before 3.11.0, all versions starting from 3.11.1"
solution: "Upgrade to versions 3.10.2, 3.11.1, 3.8.4, 3.9.6, 3.4.3, 3.5.3, 3.6.6,
  3.7.4, 3.1.2, 3.2.4, 3.3.2 or above."
urls:
- "https://github.com/micronaut-projects/micronaut-security/security/advisories/GHSA-qw22-8w9r-864h"
- "https://github.com/micronaut-projects/micronaut-security/commit/9728b925221a0d87798ccf250657a3c214b7e980"
- "https://github.com/micronaut-projects/micronaut-security/blob/master/security-oauth2/src/main/java/io/micronaut/security/oauth2/client/IdTokenClaimsValidator.java#L202"
- "https://github.com/advisories/GHSA-qw22-8w9r-864h"
uuid: "57026418-304d-4b67-95e3-10897c17737b"
cwe_ids:
- "CWE-1035"
- "CWE-937"
