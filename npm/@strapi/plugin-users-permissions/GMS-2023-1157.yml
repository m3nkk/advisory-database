---
identifier: "GMS-2023-1157"
identifiers:
- "GHSA-xv3q-jrmm-4fxv"
- "GMS-2023-1157"
package_slug: "npm/@strapi/plugin-users-permissions"
title: "Authentication Bypass in @strapi/plugin-users-permissions"
description: "### Summary\n\nStrapi through 4.5.6 does not verify the access or ID
  tokens issued during the OAuth flow when the AWS Cognito login provider is used
  for authentication.\n\n### Details\n\nStrapi through 4.5.6 does not verify the access
  or ID tokens issued during the OAuth flow when the AWS Cognito login provider is
  used for authentication. A remote attacker could forge an ID token that is signed
  using the 'None' type algorithm to bypass authentication and impersonate any user
  that use AWS Cognito for authentication.\n\n### IoC\n\nReviewing of application
  logs is recommended to detect any suspicious activity. Running the following regex
  pattern will extract all ID tokens sent to `/api/auth/cognito/callback`.\n\n`/\\/api\\/auth\\/cognito\\/callback\\?[\\s\\S]*id_token=\\s*([\\S]*)/`\n\nOnce
  you have a list of the ID tokens, you will need to verify each token using the public
  key file for your AWS Cognito user pool that you can download from `https://cognito-idp.{region}.amazonaws.com/{userPoolId}/.well-known/jwks.json`.
  If there are any JWT tokens that cannot be verified using the correct public key,
  then you need to inspect the JWT body and see if it contains the `email` and `cognito:username`
  claims (example below).\n\n```json\n{\n \"cognito:username\": \"auth-bypass-example\",\n
  \"email\": \"user@example.com\"\n}\n```\n\nIf there are any JWTs that have this
  body, verify when the account with the email address was created. If the account
  was created earlier than the request to `/api/auth/cognito/callback` with the invalid
  JWT token, then you need to contact the user to inform them their account has been
  breached!\n\nAfter upgrading to Strapi v4.6.0 or greater you will need to reconfigure
  your AWS Cognito provider to include the JWKS URL for it to work properly. If you
  do not reconfigure your provider you will receive an error message when attempting
  to login.\n\n\n### Impact\n\nAny Strapi user using the users-permissions AWS Cognito
  provider before 4.6.0\n"
date: "2023-04-18"
pubdate: "2023-04-18"
affected_range: ">=3.2.1 <4.6.0"
fixed_versions:
- "4.6.0"
affected_versions: "All versions starting from 3.2.1 before 4.6.0"
not_impacted: "All versions before 3.2.1, all versions starting from 4.6.0"
solution: "Upgrade to version 4.6.0 or above."
urls:
- "https://github.com/strapi/strapi/security/advisories/GHSA-xv3q-jrmm-4fxv"
- "https://github.com/strapi/strapi/pull/15382"
- "https://github.com/strapi/strapi/commit/d0edd25ceb49d275d710bf8d59999a2c07072893"
- "https://github.com/strapi/strapi/releases/tag/v4.6.0"
- "https://github.com/advisories/GHSA-xv3q-jrmm-4fxv"
uuid: "37512a77-ce2c-48ae-b0d9-57324ae85ae2"
cwe_ids:
- "CWE-1035"
- "CWE-937"
