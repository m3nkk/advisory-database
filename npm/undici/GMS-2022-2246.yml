---
identifier: "GMS-2022-2246"
identifiers:
- "GHSA-pgw7-wx7w-2w33"
- "GMS-2022-2246"
- "CVE-2022-32210"
package_slug: "npm/undici"
title: "ProxyAgent vulnerable to MITM"
description: "### Description\n\n`Undici.ProxyAgent` never verifies the remote server's
  certificate, and always exposes all request & response data to the proxy. This unexpectedly
  means that proxies can MitM all HTTPS traffic, and if the proxy's URL is HTTP then
  it also means that nominally HTTPS requests are actually sent via plain-text HTTP
  between Undici and the proxy server.\n\n### Impact\n\nThis affects all use of HTTPS
  via HTTP proxy using **`Undici.ProxyAgent`** with Undici or Node's global `fetch`.
  In this case, it removes all HTTPS security from all requests sent using Undici's
  `ProxyAgent`, allowing trivial MitM attacks by anybody on the network path between
  the client and the target server (local network users, your ISP, the proxy, the
  target server's ISP, etc).\nThis less seriously affects HTTPS via HTTPS proxies.
  When you send HTTPS via a proxy to a remote server, the proxy can freely view or
  modify all HTTPS traffic unexpectedly (but only the proxy). \n\nExample:\n\n```js\nsetGlobalDispatcher(new
  ProxyAgent('http://localhost:8000/')) // HTTP Proxy\n// or\nundici.request('https://example.com/',
  { dispatcher: new ProxyAgent('http://localhost:8000') }) // HTTP Proxy\n// or\nfetch('https://example.com/',
  { dispatcher: new ProxyAgent('http://localhost:8000') }) // HTTP Proxy\n```\n\n###
  Patches\n\nThis issue was patched in Undici v5.5.1.\n\n### Workarounds\n\nAt the
  time of writing, the only workaround is to not use `ProxyAgent` as a dispatcher
  for TLS Connections.\n\n### For more information\nIf you have any questions or comments
  about this advisory:\n* Open an issue in [undici repository](https://github.com/nodejs/undici/issues)\n*
  To make a report, follow the [SECURITY](https://github.com/nodejs/node/blob/HEAD/SECURITY.md)
  document\n"
date: "2022-06-17"
pubdate: "2022-06-17"
affected_range: ">=4.8.2 <=5.5.0"
fixed_versions:
- "5.5.1"
affected_versions: "All versions starting from 4.8.2 up to 5.5.0"
not_impacted: "All versions before 4.8.2, all versions after 5.5.0"
solution: "Upgrade to version 5.5.1 or above."
urls:
- "https://github.com/nodejs/undici/security/advisories/GHSA-pgw7-wx7w-2w33"
- "https://github.com/advisories/GHSA-pgw7-wx7w-2w33"
uuid: "d5956f48-febb-489d-a540-f2dc5139b8e0"
cwe_ids:
- "CWE-1035"
- "CWE-937"
