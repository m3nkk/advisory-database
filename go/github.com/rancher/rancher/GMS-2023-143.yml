---
identifier: "GMS-2023-143"
identifiers:
- "GHSA-g25r-gvq3-wrq7"
- "GMS-2023-143"
- "CVE-2022-21953"
package_slug: "go/github.com/rancher/rancher"
title: "Authenticated user can gain unauthorized shell pod and kubectl access in the
  local cluster"
description: "### Impact\n\nAn issue was discovered in Rancher where an authorization
  logic flaw allows an authenticated user on any downstream cluster to (1) open a
  shell pod in the Rancher `local` cluster and (2) have limited `kubectl` access to
  it. The expected behavior is that a user does not have such access in the Rancher
  `local` cluster unless explicitly granted.\n\nThis issue does not allow the user
  to escalate privileges in the `local` cluster directly (this would require another
  vulnerability to be exploited).\n\nThe security issue happens in two different ways:\n\n1.
  Shell pod access - This is when a user opens a shell pod in the Rancher UI to a
  downstream cluster that the user has permission to access. The web request can be
  intercepted using the browser's web inspector/network console or a proxy tool to
  change the shell's destination to the Rancher `local` cluster instead of the desired
  downstream cluster.\n\n  - This flaw cannot be exploited to access a downstream
  cluster that the user has no permissions to.\n\n  - The shell pod runs with a limited
  non-root user, reducing the severity of this issue. However, even as a non-root
  user, it is still possible download and run binaries inside the shell pod.\n\n  -
  The blast radius of this issue can increase based on the configuration of the `local`
  cluster. For example:\n\n   - If the `local` cluster has unlimited network access,
  e.g. to the Internet, the user can open a reverse network connection to the shell
  pod.\n\n   - Or access the cloud metadata API of the underlying cloud infrastructure,
  where the user can extract the credentials associated with the `local` cluster and
  use them to interact with the cloud environment (this will be limited by the permissions
  granted to the cloud credentials in question). \n\n   - Check further recommendations
  about liming access to the cloud metadata API in Rancher's [security best practices](https://ranchermanager.docs.rancher.com/reference-guides/rancher-security/kubernetes-security-best-practices).\n\n2.
  Kubectl access - When downloading the kubeconfig file of a downstream cluster that
  the user has access to, the `server` cluster address in the kubeconfig file can
  be changed to point to the Rancher `local` cluster instead of the intended downstream
  cluster.\n\n   - This can also be achieved by crafting a kubeconfig using a Rancher
  token instead of using the kubeconfig from an active cluster. \n\n  - This flaw
  cannot be exploited to access a downstream cluster that the user has no permissions
  to.\n\nNotes:\n- Rancher `local` cluster means the cluster where Rancher is installed.
  It is named as `local` inside the list of clusters in the Rancher UI.\n- Audit logs
  in Rancher can be used to identify possible abuses of this issue, by tracking API
  requests to the user ID of the user that performed the action. API audit logs can
  be enabled as described in the [documentation](https://ranchermanager.docs.rancher.com/how-to-guides/advanced-user-guides/enable-api-audit-log)
  when set to level `1` or above.\n\n### Workarounds\n\nThere is no workaround or
  direct mitigation besides updating to a patched Rancher version.\n\n### Patches\n\nPatched
  versions include releases 2.5.17, 2.6.10, 2.7.1 and later versions.\n\n### For more
  information\n\nIf you have any questions or comments about this advisory:\n\n* Reach
  out to [SUSE Rancher Security team](https://github.com/rancher/rancher/security/policy)
  for security related inquiries.\n* Open an issue in [Rancher](https://github.com/rancher/rancher/issues/new/choose)
  repository.\n* Verify our [support matrix](https://www.suse.com/suse-rancher/support-matrix/all-supported-versions/)
  and [product support lifecycle](https://www.suse.com/lifecycle/)."
date: "2023-01-25"
pubdate: "2023-01-25"
affected_range: ">=v2.5.0 <v2.5.17 || >=v2.6.0 <v2.6.10 || >=v2.7.0 <v2.7.1"
fixed_versions:
- "v2.5.17"
- "v2.6.10"
- "v2.7.1"
affected_versions: "All versions starting from 2.5.0 before 2.5.17, all versions starting
  from 2.6.0 before 2.6.10, all versions starting from 2.7.0 before 2.7.1"
not_impacted: "All versions before 2.5.0, all versions starting from 2.5.17 before
  2.6.0, all versions starting from 2.6.10 before 2.7.0, all versions starting from
  2.7.1"
solution: "Upgrade to versions 2.5.17, 2.6.10, 2.7.1 or above."
urls:
- "https://github.com/rancher/rancher/security/advisories/GHSA-g25r-gvq3-wrq7"
- "https://github.com/advisories/GHSA-g25r-gvq3-wrq7"
uuid: "af786d32-1184-4080-ad9a-2e4fb77195ab"
cwe_ids:
- "CWE-1035"
- "CWE-937"
versions:
- number: "v2.5.0"
  commit:
    tags:
    - "v2.5.0"
    - "v2.5.0-rc9"
    sha: "65f3525cdc1167872af4140d45f3153698450c52"
    timestamp: "20201006004413"
- number: "v2.6.0"
  commit:
    tags:
    - "v2.6.0"
    - "v2.6.0-rc10"
    sha: "df2432ad895c9d6be0e47e0d6d62a4c3dc8f08e5"
    timestamp: "20210830223634"
- number: "v2.7.0"
  commit:
    tags:
    - "v2.7.0"
    - "v2.7.0-novkdm"
    sha: "ce9a7aea4b13fed7acd02cc32667b2ae72f98f5a"
    timestamp: "20221116161032"
- number: "v2.5.17"
  commit:
    tags:
    - "v2.5.17"
    - "v2.5.17-rc4"
    sha: "8bcacfeafe7c8b7696318c1eb739247258e83238"
    timestamp: "20230124044749"
- number: "v2.6.10"
  commit:
    tags:
    - "v2.6.10"
    - "v2.6.10-rc7"
    sha: "2207cfed180315c015223c07ba4462888b8acf9f"
    timestamp: "20230124173128"
- number: "v2.7.1"
  commit:
    tags:
    - "v2.7.1"
    - "v2.7.1-rc5"
    sha: "bb1c35fc4258ada8829c187ca17fe28a6e61da4d"
    timestamp: "20230124173332"
