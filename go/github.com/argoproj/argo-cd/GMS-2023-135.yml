---
identifier: "GMS-2023-135"
identifiers:
- "GHSA-6p4m-hw2h-6gmw"
- "GMS-2023-135"
- "CVE-2023-22736"
package_slug: "go/github.com/argoproj/argo-cd"
title: "Controller reconciles apps outside configured namespaces when sharding is
  enabled"
description: "### Impact\n\nAll Argo CD versions starting with 2.5.0-rc1 is vulnerable
  to an authorization bypass bug which allows a malicious Argo CD user to deploy Applications
  outside the configured allowed namespaces. \n\n#### Description of exploit\n\nReconciled
  Application namespaces are specified as a comma-delimited list of glob patterns.
  When sharding is enabled on the Application controller, it does not enforce that
  list of patterns when reconciling Applications. For example, if Application namespaces
  are configured to be `argocd-*`, the Application controller may reconcile an Application
  installed in a namespace called `other`, even though it does not start with `argocd-`.\n\nReconciliation
  of the out-of-bounds Application is only triggered when the Application is updated,
  so the attacker must be able to cause an update operation on the Application resource.\n\n####
  Limitations\n\nThis bug only applies to users who have explicitly enabled the \"apps-in-any-namespace\"
  feature by setting `application.namespaces` in the argocd-cmd-params-cm ConfigMap
  or otherwise setting the `--application-namespaces` flags on the Application controller
  and API server components. The apps-in-any-namespace feature is in beta as of this
  Security Advisory's publish date.\n\nThe bug is also limited to Argo CD instances
  where sharding is enabled by increasing the `replicas` count for the Application
  controller.\n\nFinally, the AppProjects' `sourceNamespaces` field acts as a secondary
  check against this exploit. To cause reconciliation of an Application in an out-of-bounds
  namespace, an AppProject must be available which permits Applications in the out-of-bounds
  namespace.\n\n### Patches\n\nA patch for this vulnerability has been released in
  the following Argo CD versions:\n\n* v2.5.8\n* v2.6.0-rc5\n\n### Workarounds\n\nRunning
  only one replica of the Application controller will prevent exploitation of this
  bug.\n\nMaking sure all AppProjects' `sourceNamespaces` are restricted within the
  confines of the configured Application namespaces will also prevent exploitation
  of this bug.\n\n### Credits\n\nThanks to ChangZhuo Chen (@czchen) for finding the
  issue and for contributing the fix!\n\n### References\n\n* [Documentation for apps-in-any-namespace](https://argo-cd--10678.org.readthedocs.build/en/10678/operator-manual/app-any-namespace/)\n\n###
  For more information\n\n* Open an issue in [the Argo CD issue tracker](https://github.com/argoproj/argo-cd/issues)
  or [discussions](https://github.com/argoproj/argo-cd/discussions)\n* Join us on
  [Slack](https://argoproj.github.io/community/join-slack) in channel #argo-cd\n\n"
date: "2023-01-25"
pubdate: "2023-01-25"
affected_range: ">=v2.5.0-rc1 <v2.5.8 || =v2.6.0-rc4"
fixed_versions:
- "v2.5.8"
- "v2.6.0-rc5"
affected_versions: "All versions starting from 2.5.0-rc1 before 2.5.8, version 2.6.0-rc4"
not_impacted: "All versions before 2.5.0-rc1, all versions starting from 2.5.8 before
  2.6.0-rc4, all versions after 2.6.0-rc4"
solution: "Upgrade to versions 2.5.8, 2.6.0-rc5 or above. *Note*: 2.6.0-rc5 may be
  an unstable version. Use caution."
urls:
- "https://github.com/argoproj/argo-cd/security/advisories/GHSA-6p4m-hw2h-6gmw"
- "https://github.com/advisories/GHSA-6p4m-hw2h-6gmw"
uuid: "1499aa11-59f1-4d5a-a54d-4f657d5b8440"
cwe_ids:
- "CWE-1035"
- "CWE-937"
versions:
- number: "v2.5.0-rc1"
  commit:
    tags:
    - "v2.5.0-rc1"
    sha: "2bf51f401d6700f8e8b9565d9fc3f66dcf60a0b6"
    timestamp: "20221005165955"
- number: "v2.6.0-rc4"
  commit:
    tags:
    - "v2.6.0-rc4"
    sha: "590ea32083e83f651f83f71ae4a1678476fca88c"
    timestamp: "20230118021005"
- number: "v2.5.8"
  commit:
    tags:
    - "stable"
    - "v2.5.8"
    sha: "bbe870ff5904dd1cebeba6c5dcb7129ce7c2b5e2"
    timestamp: "20230125160115"
- number: "v2.6.0-rc5"
  commit:
    tags:
    - "v2.6.0-rc5"
    sha: "e790028e5cf99d65d6896830fc4ca757c91ce0d5"
    timestamp: "20230125174545"
