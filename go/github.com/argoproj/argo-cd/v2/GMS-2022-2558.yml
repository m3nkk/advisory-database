---
identifier: "GMS-2022-2558"
identifiers:
- "GHSA-2m7h-86qq-fp4v"
- "GMS-2022-2558"
- "CVE-2022-31034"
package_slug: "go/github.com/argoproj/argo-cd/v2"
title: "Insecure entropy in Argo CD's PKCE/Oauth2/OIDC params"
description: "### Impact\n\nAll versions of Argo CD starting with v0.11.0 is vulnerable
  to a variety of attacks when an SSO login is initiated from the Argo CD CLI or UI.
  The vulnerabilities are due to the use of insufficiently random values in parameters
  in Oauth2/OIDC login flows. In each case, using a relatively-predictable (time-based)
  seed in a non-cryptographically-secure pseudo-random number generator made the parameter
  less random than required by the relevant spec or by general best practices. In
  some cases, using too short a value made the entropy even less sufficient. (The
  specific weak parameters are listed in the References section.)\n\nThe attacks on
  login flows which are meant to be mitigated by these parameters are difficult to
  accomplish but can have a high impact (potentially granting an attacker admin access
  to Argo CD). The CVSS for this Security Advisory assumes the worst-case scenario.\n\n###
  Patches\n\nA patch for this vulnerability has been released in the following Argo
  CD versions:\n\n* v2.4.1\n* v2.3.5\n* v2.2.10\n* v2.1.16\n\n### Workarounds\n\nThere
  are no workarounds. You must upgrade to a patched version to resolve the vulnerability.\n\n###
  References\n\nThese are the insufficiently-random parameters:\n\n1. (since 0.11.0)
  The [`state` parameter](https://datatracker.ietf.org/doc/html/rfc6749#section-4.1.1)
  generated by the `argocd login` command for Oauth2 login used a non-cryptographically
  secure source of entropy and generated a parameter that was too short to provide
  the entropy [required in the spec](https://datatracker.ietf.org/doc/html/rfc6749#section-10.10).
  This parameter is a \"recommended\" part of the Oauth2 flow and helps protect against
  cross-site request forgery attacks.\n2. (since 1.7.2, when PKCE was added) The [`code_verifier`
  parameter](https://datatracker.ietf.org/doc/html/rfc7636#section-4.1) generated
  by the `argocd login` command for Oauth2+PKCE login used a non-cryptographically
  secure source of entropy. The attacks mitigated by PKCE [are complex but have been
  observed in the wild](https://datatracker.ietf.org/doc/html/rfc7636#section-1).\n3.
  (since 0.11.0) The [`state` parameter](https://datatracker.ietf.org/doc/html/rfc6749#section-4.1.1)
  generated by the Argo CD API server during a UI-initiated Oauth2 login used a non-cryptographically
  secure source of entropy and generated a parameter that was too short to provide
  the entropy [required in the spec](https://datatracker.ietf.org/doc/html/rfc6749#section-10.10).
  This parameter is a \"recommended\" part of the Oauth2 flow and helps protect against
  cross-site request forgery attacks.\n4. (since 0.11.0) The [`nonce` parameter](https://openid.net/specs/openid-connect-core-1_0.html#ImplicitAuthRequest)
  generated by the Argo CD API server during a UI-initiated Oauth2 implicit flow login
  used a non-cryptographically secure source of entropy and generated a parameter
  that was too short to provide sufficient entropy. This parameter is a required part
  of the OIDC implicit login flow and helps protect against replay attacks.\n\n###
  Credits\n\nOriginally discovered by @jgwest. @jannfis and @crenshaw-dev re-discovered
  the vulnerability when reviewing notes from ADA Logics' security audit of the Argo
  project sponsored by CNCF and facilitated by OSTIF. Thanks to Adam Korczynski and
  David Korczynski for their work on the audit.\n\n### For more information\n\n* Open
  an issue in [the Argo CD issue tracker](https://github.com/argoproj/argo-cd/issues)
  or [discussions](https://github.com/argoproj/argo-cd/discussions)\n* Join us on
  [Slack](https://argoproj.github.io/community/join-slack) in channel #argo-cd\n"
date: "2022-06-23"
pubdate: "2022-06-21"
affected_range: "<v2.1.16 || >=v2.2.0 <v2.2.10 || >=v2.3.0 <v2.3.5 || =v2.4.0"
fixed_versions:
- "v2.1.16"
- "v2.2.10"
- "v2.3.5"
- "v2.4.1"
affected_versions: "All versions before 2.1.16, all versions starting from 2.2.0 before
  2.2.10, all versions starting from 2.3.0 before 2.3.5, version 2.4.0"
not_impacted: "All versions starting from 2.1.16 before 2.2.0, all versions starting
  from 2.2.10 before 2.3.0, all versions starting from 2.3.5 before 2.4.0, all versions
  after 2.4.0"
solution: "Upgrade to versions 2.1.16, 2.2.10, 2.3.5, 2.4.1 or above."
urls:
- "https://github.com/argoproj/argo-cd/security/advisories/GHSA-2m7h-86qq-fp4v"
- "https://github.com/advisories/GHSA-2m7h-86qq-fp4v"
uuid: "56b708be-4750-4ea9-ba85-e93df4c2b146"
cwe_ids:
- "CWE-1035"
- "CWE-937"
versions:
- number: "v2.2.0"
  commit:
    tags:
    - "v2.2.0"
    sha: "6da92a8e8103ce4145bb0fe2b7e952be79c9ff0a"
    timestamp: "20211214180104"
- number: "v2.3.0"
  commit:
    tags:
    - "v2.3.0"
    sha: "fe427802293b090f43f91f5839393174df6c3b3a"
    timestamp: "20220306061859"
- number: "v2.4.0"
  commit:
    tags:
    - "stable"
    - "v2.4.0"
    sha: "91aefabc5b213a258ddcfe04b8e69bb4a2dd2566"
    timestamp: "20220610171343"
- number: "v2.1.16"
  commit:
    tags:
    - "v2.1.16"
    sha: "903db5fe464032bd5a10bf32fe17639e76634c2a"
    timestamp: "20220621161926"
- number: "v2.2.10"
  commit:
    tags:
    - "v2.2.10"
    sha: "8db0e57b738ff5b0b276031573576fdc3498c04f"
    timestamp: "20220621162737"
- number: "v2.4.1"
  commit:
    tags:
    - "v2.4.1"
    sha: "52e6025f8b565705025d029e8bed36d6caa5ecf7"
    timestamp: "20220621162747"
- number: "v2.3.5"
  commit:
    tags:
    - "v2.3.5"
    sha: "1287d24bfe47bcaa6e791e5ff12fa1c1bf57a442"
    timestamp: "20220621162823"
