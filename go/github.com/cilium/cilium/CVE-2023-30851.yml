---
identifier: "CVE-2023-30851"
identifiers:
- "GHSA-2h44-x2wx-49f4"
- "CVE-2023-30851"
package_slug: "go/github.com/cilium/cilium"
title: "Potential HTTP policy bypass when using header rules in Cilium"
description: "### Impact\n\nThis issue only impacts users who:\n\n- Have a HTTP policy
  that applies to multiple `toEndpoints` AND\n- Have an allow-all rule in place that
  affects only one of those endpoints\n\nIn such cases, a wildcard rule will be appended
  to the set of HTTP rules, which could cause bypass of HTTP policies.\n\n### Patches\n\nThis
  issue has been patched in Cilium 1.11.16, 1.12.9, and 1.13.2.\n\n### Workarounds\n\nRewrite
  HTTP rules for each endpoint separately. For example, if the initial rule looks
  like:\n\n```\n egress:\n  - toEndpoints:\n    - matchLabels:\n      k8s:kind: echo\n
  \   - matchLabels:\n      k8s:kind: example\n   toPorts:\n    - ports:\n      -
  port: \"8080\"\n       protocol: TCP\n     rules:\n      http:\n       - method:
  \"GET\"\n```\n\nIt should be rewritten to:\n\n```\n egress:\n  - toEndpoints:\n
  \   - matchLabels:\n      k8s:kind: echo\n   toPorts:\n    - ports:\n      - port:
  \"8080\"\n       protocol: TCP\n     rules:\n      http:\n       - method: \"GET\"\n
  \ - toEndpoints:\n    - matchLabels:\n      k8s:kind: example\n   toPorts:\n    -
  ports:\n      - port: \"8080\"\n       protocol: TCP\n     rules:\n      http:\n
  \      - method: \"GET\"\n```   \n\n### Acknowledgements\n\nThe Cilium community
  has worked together with members of Isovalent to prepare these mitigations. Special
  thanks to @jrajahalme for investigating and fixing the issue.\n\n### For more information\n\nIf
  you have any questions or comments about this advisory, please reach out on [Slack](https://docs.cilium.io/en/latest/community/community/#slack).\n\nAs
  usual, if you think you found a related vulnerability, we strongly encourage you
  to report security vulnerabilities to our private security mailing list: [security@cilium.io](mailto:security@cilium.io)
  - first, before disclosing them in any public forums. This is a private mailing
  list where only members of the Cilium internal security team are subscribed to,
  and is treated as top priority.\n"
date: "2023-05-22"
pubdate: "2023-05-22"
affected_range: "<1.11.16||>=1.12.0 <1.12.9||>=1.13.0 <1.13.2"
fixed_versions:
- "1.11.16"
- "1.12.9"
- "1.13.2"
affected_versions: "All versions before 1.11.16, all versions starting from 1.12.0
  before 1.12.9, all versions starting from 1.13.0 before 1.13.2"
not_impacted: "All versions starting from 1.11.16 before 1.12.0, all versions starting
  from 1.12.9 before 1.13.0, all versions starting from 1.13.2"
solution: "Upgrade to versions 1.11.16, 1.12.9, 1.13.2 or above."
urls:
- "https://github.com/cilium/cilium/security/advisories/GHSA-2h44-x2wx-49f4"
- "https://github.com/cilium/cilium/releases/tag/v1.11.16"
- "https://github.com/cilium/cilium/releases/tag/v1.12.9"
- "https://github.com/cilium/cilium/releases/tag/v1.13.2"
- "https://github.com/advisories/GHSA-2h44-x2wx-49f4"
uuid: "4952d141-aafd-4b02-b663-cdc996f5f83c"
cwe_ids:
- "CWE-1035"
- "CWE-937"
